<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker - Tharun & Jomy</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Light Theme */
            --primary: #4361ee;
            --secondary: #3f37c9;
            --background: #f5f7fa;
            --surface: #ffffff;
            --surface-hover: #f0f2f5;
            --text: #212529;
            --text-secondary: #6c757d;
            --border: #dee2e6;
            --danger: #e63946;
            --success: #2a9d8f;
            --warning: #f9c74f;
            --info: #4cc9f0;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --hover-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            --header-gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        [data-theme="dark"] {
            --primary: #4cc9f0;
            --secondary: #4361ee;
            --background: #121212;
            --surface: #1e1e1e;
            --surface-hover: #2d2d2d;
            --text: #f8f9fa;
            --text-secondary: #adb5bd;
            --border: #343a40;
            --danger: #e63946;
            --success: #2a9d8f;
            --warning: #f9c74f;
            --info: #4cc9f0;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            --hover-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            --header-gradient: linear-gradient(135deg, #2b2d42, #121212);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: var(--header-gradient);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--primary);
        }

        .app-description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
        }

        .task-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--background);
            padding: 1rem 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            background-color: var(--surface);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 1rem;
            padding-left: 45px;
            color: var(--text);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .github-btn {
            background-color: #333;
        }

        [data-theme="dark"] .github-btn {
            background-color: #24292e;
        }

        .task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .task-card {
            background-color: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            background-color: var(--surface-hover);
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--primary);
        }

        .task-status {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
        }

        .not-started {
            background-color: var(--surface-hover);
            color: var(--text-secondary);
        }

        .in-progress {
            background-color: var(--warning);
            color: #664d03;
        }

        .completed {
            background-color: var(--success);
            color: white;
        }

        .task-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-right: 40px;
            color: var(--text);
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .task-actions button {
            padding: 5px;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-edit {
            background-color: var(--info);
        }

        .btn-delete {
            background-color: var(--danger);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--text);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background-color: var(--surface);
            color: var(--text);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236c757d'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
            padding-right: 45px;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .btn-cancel {
            background-color: #6c757d;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background-color: var(--surface);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 8px 16px;
        }

        .filter-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            background-color: var(--surface);
            border-radius: 12px;
            grid-column: 1 / -1;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            color: white;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            animation: slideInNotification 0.3s forwards;
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--danger);
        }

        @keyframes slideInNotification {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            margin-left: 10px;
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-left: 15px;
        }

        .sync-indicator i {
            font-size: 0.9rem;
        }

        .sync-status {
            display: none;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
            margin-left: auto;
        }

        .sync-status.online {
            background-color: rgba(42, 157, 143, 0.2);
            color: var(--success);
        }

        .sync-status.offline {
            background-color: rgba(230, 57, 70, 0.2);
            color: var(--danger);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .user-info {
                margin-top: 1rem;
            }
            
            .task-controls {
                flex-direction: column;
            }

            .filter-group {
                overflow-x: auto;
                width: 100%;
                padding-bottom: 10px;
                justify-content: flex-start;
                flex-wrap: nowrap;
            }
            
            .filter-btn {
                flex-shrink: 0;
            }

            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }

            .search-box {
                min-width: auto;
                width: 100%;
            }

            .task-card {
                min-height: 180px;
            }
        }

        /* For small phones */
        @media (max-width: 480px) {
            header {
                padding: 1.5rem 0;
            }

            h1 {
                font-size: 1.5rem;
            }

            .app-description {
                font-size: 0.9rem;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
            }

            .task-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }

            button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <header>
        <div class="container">
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <div class="header-content">
                <div>
                    <h1>Task Tracker</h1>
                    <p class="app-description">A modern task tracker for Tharun Kommaddi and Jomy Joseph to collaborate efficiently.</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">T</div>
                    <span id="userName">Tharun Kommaddi</span>
                    <div class="sync-status" id="syncStatus">
                        <i class="fas fa-cloud"></i>
                        <span>Connected</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="task-controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchTasks" placeholder="Search tasks...">
            </div>
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="not-started">Not Started</button>
                <button class="filter-btn" data-filter="in-progress">In Progress</button>
                <button class="filter-btn" data-filter="completed">Completed</button>
            </div>
            <div class="action-buttons">
                <button id="syncGitHubBtn" class="github-btn">
                    <i class="fab fa-github"></i>
                    <span class="btn-text">Setup GitHub Sync</span>
                </button>
                <button id="addTaskBtn">
                    <i class="fas fa-plus"></i>
                    <span class="btn-text">Add Task</span>
                </button>
            </div>
        </div>

        <div class="task-grid" id="taskGrid">
            <!-- Tasks will be dynamically loaded here -->
        </div>
    </main>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2 id="modalTitle">Add New Task</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="taskTitle">Task Title</label>
                    <input type="text" id="taskTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label for="taskStatus">Status</label>
                    <select id="taskStatus" class="form-control">
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskAssignee">Assignee</label>
                    <select id="taskAssignee" class="form-control">
                        <option value="Tharun Kommaddi">Tharun Kommaddi</option>
                        <option value="Jomy Joseph">Jomy Joseph</option>
                    </select>
                </div>
                <div class="button-group">
                    <button type="button" class="btn-cancel" id="cancelTask">Cancel</button>
                    <button type="submit" id="saveTaskBtn">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- GitHub Setup Modal -->
    <div class="modal" id="gitHubSetupModal">
        <div class="modal-content">
            <span class="close-modal" id="closeGitHubModal">&times;</span>
            <h2>Setup GitHub Sync</h2>
            <p style="margin: 15px 0;">This will allow you to automatically sync tasks with your GitHub repository.</p>
            
            <div class="form-group">
                <label for="repoOwnerInput">GitHub Username:</label>
                <input type="text" id="repoOwnerInput" placeholder="e.g., tharunkommaddi" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="repoNameInput">Repository Name:</label>
                <input type="text" id="repoNameInput" placeholder="e.g., task-tracker" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="tokenInput">GitHub Personal Access Token:</label>
                <input type="password" id="tokenInput" class="form-control">
                <small style="display: block; margin-top: 5px; color: var(--text-secondary);">You need a token with 'repo' scope. <a href="https://github.com/settings/tokens/new" target="_blank" style="color: var(--primary);">Create one here</a></small>
            </div>
            
            <div class="button-group">
                <button id="cancelSetupBtn" class="btn-cancel">Cancel</button>
                <button id="testConnectionBtn" style="background-color: var(--info);">Test Connection</button>
                <button id="saveSetupBtn">Save & Sync</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let tasks = [];
        let repoOwner = 'YOUR_GITHUB_USERNAME';
        let repoName = 'task-tracker';
        const filePath = 'tasks.json';
        const ghTokenKey = 'gh_token';
        let currentFilter = 'all';
        let isDeleting = false;
        
        // DOM elements
        const taskGrid = document.getElementById('taskGrid');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskModal = document.getElementById('taskModal');
        const closeModal = document.getElementById('closeModal');
        const cancelTask = document.getElementById('cancelTask');
        const taskForm = document.getElementById('taskForm');
        const modalTitle = document.getElementById('modalTitle');
        const taskIdInput = document.getElementById('taskId');
        const searchInput = document.getElementById('searchTasks');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const syncGitHubBtn = document.getElementById('syncGitHubBtn');
        const themeToggle = document.getElementById('themeToggle');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const syncStatus = document.getElementById('syncStatus');
        const gitHubSetupModal = document.getElementById('gitHubSetupModal');
        const closeGitHubModal = document.getElementById('closeGitHubModal');
        const cancelSetupBtn = document.getElementById('cancelSetupBtn');
        const testConnectionBtn = document.getElementById('testConnectionBtn');
        const saveSetupBtn = document.getElementById('saveSetupBtn');
        
        // Initialize the app
        function init() {
            // Set up theme
            initTheme();
            
            // Load any saved GitHub settings
            repoOwner = localStorage.getItem('gh_owner') || repoOwner;
            repoName = localStorage.getItem('gh_repo') || repoName;
            
            // Update the UI based on sync status
            updateSyncUI();
            
            // First try to load from localStorage
            const localTasks = localStorage.getItem('tasks');
            if (localTasks) {
                tasks = JSON.parse(localTasks);
                renderTasks();
            } else {
                renderEmptyState();
            }
            
            // Then try to sync with GitHub if configured
            if (localStorage.getItem('gh_owner') && localStorage.getItem('gh_repo') && localStorage.getItem(ghTokenKey)) {
                syncWithGitHub().catch(error => {
                    console.error('Error during initial GitHub sync:', error);
                    showNotification(`GitHub sync failed: ${error.message}`, 'error');
                });
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Check online status
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        }
        
        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }
        
        // Update theme icon
        function updateThemeIcon(theme) {
            themeToggle.innerHTML = theme === 'dark' ? 
                '<i class="fas fa-sun"></i>' : 
                '<i class="fas fa-moon"></i>';
        }
        
        // Toggle theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Task actions
            addTaskBtn.addEventListener('click', openAddTaskModal);
            closeModal.addEventListener('click', closeTaskModal);
            cancelTask.addEventListener('click', closeTaskModal);
            taskForm.addEventListener('submit', saveTask);
            
            // Search and filter
            searchInput.addEventListener('input', filterTasks);
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.getAttribute('data-filter');
                    renderTasks();
                });
            });
            
            // GitHub sync
            syncGitHubBtn.addEventListener('click', openGitHubSetupModal);
            closeGitHubModal.addEventListener('click', closeGitHubSetupModal);
            cancelSetupBtn.addEventListener('click', closeGitHubSetupModal);
            testConnectionBtn.addEventListener('click', testGitHubConnection);
            saveSetupBtn.addEventListener('click', saveGitHubSetup);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // Update online status
        function updateOnlineStatus() {
            if (navigator.onLine) {
                syncStatus.className = 'sync-status online';
                syncStatus.innerHTML = '<i class="fas fa-cloud"></i><span>Connected</span>';
            } else {
                syncStatus.className = 'sync-status offline';
                syncStatus.innerHTML = '<i class="fas fa-cloud-slash"></i><span>Offline</span>';
            }
            
            // Only show if GitHub is configured
            if (localStorage.getItem('gh_owner') && localStorage.getItem('gh_repo') && localStorage.getItem(ghTokenKey)) {
                syncStatus.style.display = 'flex';
            } else {
                syncStatus.style.display = 'none';
            }
        }
        
        // Update sync UI
        function updateSyncUI() {
            if (localStorage.getItem('gh_owner') && localStorage.getItem('gh_repo') && localStorage.getItem(ghTokenKey)) {
                syncGitHubBtn.innerHTML = '<i class="fas fa-sync-alt"></i><span class="btn-text">Sync Now</span>';
                syncGitHubBtn.removeEventListener('click', openGitHubSetupModal);
                syncGitHubBtn.addEventListener('click', function() {
                    syncWithGitHub().catch(error => {
                        console.error('Error during manual sync:', error);
                        showNotification(`GitHub sync failed: ${error.message}`, 'error');
                    });
                });
                
                // Update user info display
                const assignee = localStorage.getItem('user_name');
                if (assignee) {
                    document.getElementById('userName').textContent = assignee;
                    document.getElementById('userAvatar').textContent = assignee.charAt(0);
                }
                
                syncStatus.style.display = 'flex';
            } else {
                syncGitHubBtn.innerHTML = '<i class="fab fa-github"></i><span class="btn-text">Setup GitHub Sync</span>';
                syncGitHubBtn.removeEventListener('click', syncWithGitHub);
                syncGitHubBtn.addEventListener('click', openGitHubSetupModal);
                syncStatus.style.display = 'none';
            }
        }
        
        // Open GitHub setup modal
        function openGitHubSetupModal() {
            // Fill in saved values if available
            document.getElementById('repoOwnerInput').value = localStorage.getItem('gh_owner') || '';
            document.getElementById('repoNameInput').value = localStorage.getItem('gh_repo') || '';
            document.getElementById('tokenInput').value = localStorage.getItem(ghTokenKey) || '';
            
            gitHubSetupModal.style.display = 'flex';
        }
        
        // Close GitHub setup modal
        function closeGitHubSetupModal() {
            gitHubSetupModal.style.display = 'none';
        }
        
        // Test GitHub connection
        async function testGitHubConnection() {
            const owner = document.getElementById('repoOwnerInput').value.trim();
            const repo = document.getElementById('repoNameInput').value.trim();
            const token = document.getElementById('tokenInput').value.trim();
            
            if (!owner || !repo || !token) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                showLoading(false);
                
                if (response.ok) {
                    showNotification('Connection successful! Your GitHub repository is accessible.', 'success');
                } else if (response.status === 404) {
                    showNotification('Repository not found. Please check the username and repository name.', 'error');
                } else {
                    showNotification(`Error: ${response.status}. Please check your token and permissions.`, 'error');
                }
            } catch (error) {
                showLoading(false);
                showNotification(`Connection error: ${error.message}`, 'error');
            }
        }
        
        // Save GitHub setup
        async function saveGitHubSetup() {
            const owner = document.getElementById('repoOwnerInput').value.trim();
            const repo = document.getElementById('repoNameInput').value.trim();
            const token = document.getElementById('tokenInput').value.trim();
            
            if (!owner || !repo || !token) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            // Save the values
            localStorage.setItem('gh_owner', owner);
            localStorage.setItem('gh_repo', repo);
            localStorage.setItem(ghTokenKey, token);
            
            // Also save current user
            const userName = document.getElementById('userName').textContent;
            localStorage.setItem('user_name', userName);
            
            // Update global variables
            repoOwner = owner;
            repoName = repo;
            
            // Update UI
            updateSyncUI();
            
            // Try to sync
            closeGitHubSetupModal();
            showNotification('GitHub settings saved. Syncing tasks...', 'success');
            
            try {
                await syncWithGitHub();
            } catch (error) {
                console.error('Sync error:', error);
                showNotification(`Error syncing with GitHub: ${error.message}`, 'error');
            }
        }
        
        // Load tasks from GitHub
        async function loadTasksFromGitHub() {
            const owner = localStorage.getItem('gh_owner');
            const repo = localStorage.getItem('gh_repo');
            const token = localStorage.getItem(ghTokenKey);
            
            if (!owner || !repo || !token || !navigator.onLine) {
                return null;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (response.status === 404) {
                    // File doesn't exist yet
                    return { tasks: [], exists: false };
                }
                
                if (!response.ok) {
                    throw new Error(`GitHub API returned ${response.status}`);
                }
                
                const data = await response.json();
                const content = atob(data.content); // Decode base64
                return {
                    tasks: JSON.parse(content),
                    sha: data.sha,
                    exists: true
                };
            } catch (error) {
                console.error('Error loading tasks from GitHub:', error);
                throw error;
            }
        }
        
        // Save tasks to GitHub
        async function saveTasksToGitHub() {
            const owner = localStorage.getItem('gh_owner');
            const repo = localStorage.getItem('gh_repo');
            const token = localStorage.getItem(ghTokenKey);
            
            if (!owner || !repo || !token || !navigator.onLine) {
                return false;
            }
            
            try {
                // First check if the file exists and get its SHA
                let sha = localStorage.getItem('tasksSHA');
                let method = 'PUT';
                let url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
                
                // If we're deleting all tasks and the file exists, delete it
                if (tasks.length === 0 && sha) {
                    const deleteResponse = await fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Delete tasks.json via Task Tracker',
                            sha: sha
                        })
                    });
                    
                    if (deleteResponse.ok) {
                        localStorage.removeItem('tasksSHA');
                        return true;
                    } else {
                        throw new Error(`Failed to delete file: ${deleteResponse.status}`);
                    }
                }
                
                // Prepare the content
                const content = JSON.stringify(tasks, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content))); // Encode to base64
                
                // Prepare the request body
                const body = {
                    message: 'Update tasks via Task Tracker',
                    content: encodedContent
                };
                
                // Include SHA if we have it (for updates)
                if (sha) {
                    body.sha = sha;
                }
                
                // Send the request
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                if (!response.ok) {
                    throw new Error(`GitHub API returned ${response.status}`);
                }
                
                const responseData = await response.json();
                localStorage.setItem('tasksSHA', responseData.content.sha);
                
                return true;
            } catch (error) {
                console.error('Error saving tasks to GitHub:', error);
                throw error;
            }
        }
        
        // Sync with GitHub
        async function syncWithGitHub() {
            if (!navigator.onLine) {
                showNotification('You are offline. Changes will sync when you reconnect.', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // First get the remote tasks
                const remoteData = await loadTasksFromGitHub();
                
                if (remoteData) {
                    // Merge local and remote tasks
                    if (remoteData.exists) {
                        mergeTasks(remoteData.tasks);
                        localStorage.setItem('tasksSHA', remoteData.sha);
                    }
                    
                    // Save the merged tasks back to GitHub
                    await saveTasksToGitHub();
                    
                    // Save to localStorage as backup
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                    
                    showNotification('Tasks successfully synced with GitHub!', 'success');
                } else {
                    // No remote data, just push local tasks
                    await saveTasksToGitHub();
                    showNotification('Local tasks pushed to GitHub!', 'success');
                }
                
                renderTasks();
            } catch (error) {
                console.error('GitHub sync error:', error);
                showNotification(`GitHub sync failed: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Merge remote and local tasks
        function mergeTasks(remoteTasks) {
            // Create a map of tasks by ID for quick lookup
            const taskMap = {};
            tasks.forEach(task => {
                taskMap[task.id] = task;
            });
            
            // Create a set of task IDs to track deletions
            const taskIds = new Set(tasks.map(task => task.id));
            
            // Merge remote tasks
            remoteTasks.forEach(remoteTask => {
                const localTask = taskMap[remoteTask.id];
                
                if (!localTask) {
                    // Task doesn't exist locally, add it
                    tasks.push(remoteTask);
                } else {
                    // Task exists, use the one with the latest updatedAt
                    const remoteDate = new Date(remoteTask.updatedAt);
                    const localDate = new Date(localTask.updatedAt);
                    
                    if (remoteDate > localDate) {
                        // Remote task is newer, update local task
                        Object.assign(localTask, remoteTask);
                    }
                }
                
                // Mark this task as seen
                taskIds.delete(remoteTask.id);
            });
            
            // If isDeleting flag is not set, we're in a normal sync
            // and should keep local tasks not in remote
            if (!isDeleting) {
                return;
            }
            
            // Remove any local tasks that were deleted remotely
            if (taskIds.size > 0) {
                tasks = tasks.filter(task => !taskIds.has(task.id));
            }
            
            // Reset the deletion flag
            isDeleting = false;
        }
        
        // Render tasks
        function renderTasks() {
            const searchTerm = searchInput.value.toLowerCase();
            
            // Filter tasks based on search term and current filter
            const filteredTasks = tasks.filter(task => {
                const matchesSearch = task.title.toLowerCase().includes(searchTerm) || 
                                     task.description.toLowerCase().includes(searchTerm);
                const matchesFilter = currentFilter === 'all' || task.status === currentFilter;
                return matchesSearch && matchesFilter;
            });
            
            // Clear the task grid
            taskGrid.innerHTML = '';
            
            if (filteredTasks.length === 0) {
                renderEmptyState();
                return;
            }
            
            // Create task cards
            filteredTasks.forEach(task => {
                const taskCard = createTaskCard(task);
                taskGrid.appendChild(taskCard);
            });
        }
        
        // Render empty state
        function renderEmptyState() {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            
            const icon = tasks.length === 0 ? 'fas fa-tasks' : 'fas fa-filter';
            const title = tasks.length === 0 ? 'No tasks yet' : 'No matching tasks';
            const message = tasks.length === 0 ? 
                'No tasks have been added yet. Get started by adding your first task.' : 
                'Try changing your search or filter to find what you\'re looking for.';
            
            emptyState.innerHTML = `
                <i class="${icon}"></i>
                <h3>${title}</h3>
                <p>${message}</p>
                <button id="emptyAddTaskBtn">
                    <i class="fas fa-plus"></i>
                    <span>Add ${tasks.length === 0 ? 'Your First' : 'New'} Task</span>
                </button>
            `;
            
            taskGrid.appendChild(emptyState);
            
            // Add event listener to the button
            document.getElementById('emptyAddTaskBtn').addEventListener('click', openAddTaskModal);
            
            // If no GitHub sync is set up and no tasks, show the setup button
            if (tasks.length === 0 && (!localStorage.getItem('gh_owner') || !localStorage.getItem(ghTokenKey))) {
                const setupContainer = document.createElement('div');
                setupContainer.style.marginTop = '2rem';
                setupContainer.style.textAlign = 'center';
                
                const setupButton = document.createElement('button');
                setupButton.className = 'github-btn';
                setupButton.innerHTML = '<i class="fab fa-github"></i> Setup GitHub Sync';
                
                setupButton.addEventListener('click', openGitHubSetupModal);
                
                setupContainer.appendChild(setupButton);
                emptyState.appendChild(setupContainer);
            }
        }
        
        // Create task card element
        function createTaskCard(task) {
            const taskCard = document.createElement('div');
            taskCard.className = 'task-card';
            taskCard.setAttribute('data-id', task.id);
            
            // Set status icon
            let statusIcon, statusClass;
            switch(task.status) {
                case 'not-started':
                    statusIcon = '<i class="far fa-circle"></i>';
                    statusClass = 'not-started';
                    break;
                case 'in-progress':
                    statusIcon = '<i class="fas fa-clock"></i>';
                    statusClass = 'in-progress';
                    break;
                case 'completed':
                    statusIcon = '<i class="fas fa-check"></i>';
                    statusClass = 'completed';
                    break;
            }
            
            // Format date
            const date = new Date(task.createdAt);
            const formattedDate = date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            taskCard.innerHTML = `
                <div class="task-status ${statusClass}">${statusIcon}</div>
                <h3 class="task-title">${escapeHtml(task.title)}</h3>
                <p class="task-description">${escapeHtml(task.description)}</p>
                <div class="task-meta">
                    <div>
                        <i class="fas fa-user-circle"></i> ${escapeHtml(task.assignee)}
                    </div>
                    <div>
                        <i class="far fa-calendar-alt"></i> ${formattedDate}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn-edit edit-task" data-id="${task.id}" title="Edit Task">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-delete delete-task" data-id="${task.id}" title="Delete Task">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            // Add event listeners
            taskCard.querySelector('.edit-task').addEventListener('click', () => openEditTaskModal(task.id));
            taskCard.querySelector('.delete-task').addEventListener('click', () => deleteTask(task.id));
            
            return taskCard;
        }
        
        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Open add task modal
        function openAddTaskModal() {
            modalTitle.textContent = 'Add New Task';
            taskForm.reset();
            taskIdInput.value = '';
            taskModal.style.display = 'flex';
        }
        
        // Open edit task modal
        function openEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            modalTitle.textContent = 'Edit Task';
            taskIdInput.value = task.id;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskAssignee').value = task.assignee;
            
            taskModal.style.display = 'flex';
        }
        
        // Close task modal
        function closeTaskModal() {
            taskModal.style.display = 'none';
        }
        
        // Save task
        async function saveTask(e) {
            e.preventDefault();
            
            const taskId = taskIdInput.value;
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const status = document.getElementById('taskStatus').value;
            const assignee = document.getElementById('taskAssignee').value;
            
            showLoading(true);
            
            if (taskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        description,
                        status,
                        assignee,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // Add new task
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    description,
                    status,
                    assignee,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                tasks.push(newTask);
            }
            
            // Save to localStorage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Try to sync with GitHub
            try {
                if (localStorage.getItem('gh_owner') && localStorage.getItem('gh_repo') && localStorage.getItem(ghTokenKey)) {
                    await saveTasksToGitHub();
                }
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                showNotification('Task saved locally but GitHub sync failed. Will try again later.', 'error');
            } finally {
                showLoading(false);
            }
            
            // Close modal and render tasks
            closeTaskModal();
            renderTasks();
            showNotification('Task saved successfully!', 'success');
        }
        
        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) {
                return;
            }
            
            showLoading(true);
            
            // Set delete flag to ensure proper sync
            isDeleting = true;
            
            // Remove the task from the array
            tasks = tasks.filter(t => t.id !== taskId);
            
            // Save to localStorage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Try to sync with GitHub
            try {
                if (localStorage.getItem('gh_owner') && localStorage.getItem('gh_repo') && localStorage.getItem(ghTokenKey)) {
                    await saveTasksToGitHub();
                }
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                showNotification('Task deleted locally but GitHub sync failed. Will try again later.', 'error');
            } finally {
                showLoading(false);
            }
            
            renderTasks();
            showNotification('Task deleted successfully!', 'success');
        }
        
        // Filter tasks based on search input
        function filterTasks() {
            renderTasks();
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                document.body.removeChild(notification);
            });
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            // Icon based on type
            let icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
                <button class="notification-close"><i class="fas fa-times"></i></button>
            `;
            
            // Add to document
            document.body.appendChild(notification);
            
            // Add close button listener
            notification.querySelector('.notification-close').addEventListener('click', () => {
                document.body.removeChild(notification);
            });
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 5000);
        }
        
        // Show/hide loading spinner
        function showLoading(show) {
            loadingSpinner.style.display = show ? 'flex' : 'none';
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
